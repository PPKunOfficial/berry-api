# Berry API Workspace ç»“æ„

## ğŸ“ é¡¹ç›®é‡æ„è¯´æ˜

é¡¹ç›®å·²æˆåŠŸé‡æ„ä¸ºå¤šä¸ªworkspaceï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡ä»£ç ç»“æ„ï¼Œé¿å…è‡ƒè‚¿çš„å•ä½“æ¶æ„ã€‚

## ğŸ—ï¸ Workspace ç»“æ„

```
berry-api/
â”œâ”€â”€ Cargo.toml                 # Workspace æ ¹é…ç½®
â”œâ”€â”€ berry-core/                # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ lib.rs
â”‚       â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ auth/              # è®¤è¯ç³»ç»Ÿ
â”œâ”€â”€ berry-loadbalance/         # è´Ÿè½½å‡è¡¡åº“
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ lib.rs
â”‚       â””â”€â”€ loadbalance/       # è´Ÿè½½å‡è¡¡é€»è¾‘
â”œâ”€â”€ berry-relay/               # è¯·æ±‚è½¬å‘åº“
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ lib.rs
â”‚       â””â”€â”€ relay/             # è¯·æ±‚è½¬å‘å¤„ç†
â”œâ”€â”€ berry-api/                 # APIæœåŠ¡å™¨
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.rs
â”‚       â”œâ”€â”€ lib.rs
â”‚       â”œâ”€â”€ app.rs
â”‚       â”œâ”€â”€ router/            # è·¯ç”±å¤„ç†
â”‚       â””â”€â”€ static_files.rs
â””â”€â”€ berry-cli/                 # å‘½ä»¤è¡Œå·¥å…·
    â”œâ”€â”€ Cargo.toml
    â””â”€â”€ src/
        â””â”€â”€ main.rs
```

## ğŸ“¦ å„WorkspaceåŠŸèƒ½

### 1. **berry-core** - æ ¸å¿ƒåº“
- **é…ç½®ç®¡ç†**: é…ç½®æ–‡ä»¶åŠ è½½ã€éªŒè¯ã€æ•°æ®ç»“æ„å®šä¹‰
- **è®¤è¯ç³»ç»Ÿ**: ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶ã€ä¸­é—´ä»¶
- **å…±äº«ç±»å‹**: æ‰€æœ‰workspaceå…±ç”¨çš„åŸºç¡€ç±»å‹å’Œå·¥å…·

**ä¸»è¦å¯¼å‡º**:
```rust
pub use berry_core::{Config, Provider, Model, UserToken, Backend, LoadBalanceStrategy, BillingMode};
pub use berry_core::{AuthenticatedUser, AuthError, AuthMiddleware};
```

### 2. **berry-loadbalance** - è´Ÿè½½å‡è¡¡åº“
- **è´Ÿè½½å‡è¡¡ç­–ç•¥**: æƒé‡éšæœºã€è½®è¯¢ã€æœ€ä½å»¶è¿Ÿç­‰
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹åç«¯å¥åº·çŠ¶æ€
- **æŒ‡æ ‡æ”¶é›†**: æ€§èƒ½æŒ‡æ ‡å’Œå¥åº·çŠ¶æ€ç»Ÿè®¡
- **æ•…éšœè½¬ç§»**: æ™ºèƒ½æ•…éšœæ£€æµ‹å’Œæ¢å¤

**ä¸»è¦å¯¼å‡º**:
```rust
pub use berry_loadbalance::{LoadBalanceService, LoadBalanceManager, BackendSelector, HealthChecker};
```

### 3. **berry-relay** - è¯·æ±‚è½¬å‘åº“
- **è¯·æ±‚å¤„ç†å™¨**: è´Ÿè½½å‡è¡¡çš„è¯·æ±‚å¤„ç†
- **å®¢æˆ·ç«¯å®ç°**: OpenAIå…¼å®¹çš„HTTPå®¢æˆ·ç«¯
- **åè®®é€‚é…**: ä¸åŒAIæœåŠ¡æä¾›å•†çš„åè®®è½¬æ¢

**ä¸»è¦å¯¼å‡º**:
```rust
pub use berry_relay::LoadBalancedHandler;
```

### 4. **berry-api** - APIæœåŠ¡å™¨
- **è·¯ç”±ç®¡ç†**: æ‰€æœ‰APIç«¯ç‚¹çš„è·¯ç”±é…ç½®
- **åº”ç”¨çŠ¶æ€**: å…¨å±€åº”ç”¨çŠ¶æ€ç®¡ç†
- **é™æ€æ–‡ä»¶**: ç›‘æ§ç•Œé¢çš„é™æ€æ–‡ä»¶æœåŠ¡
- **ä¸»ç¨‹åº**: æœåŠ¡å™¨å¯åŠ¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

**å¯æ‰§è¡Œæ–‡ä»¶**: `berry-api`

### 5. **berry-cli** - å‘½ä»¤è¡Œå·¥å…·
- **é…ç½®éªŒè¯**: éªŒè¯é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§
- **å¥åº·æ£€æŸ¥**: æ‰‹åŠ¨è§¦å‘å¥åº·æ£€æŸ¥
- **ç®¡ç†å‘½ä»¤**: å„ç§ç®¡ç†å’Œè°ƒè¯•åŠŸèƒ½

**å¯æ‰§è¡Œæ–‡ä»¶**: `berry-cli`

## ğŸ”§ ç¼–è¯‘å’Œè¿è¡Œ

### ç¼–è¯‘æ•´ä¸ªworkspace
```bash
cargo build --workspace
```

### ç¼–è¯‘ç‰¹å®šç»„ä»¶
```bash
cargo build -p berry-api
cargo build -p berry-cli
```

### è¿è¡ŒAPIæœåŠ¡å™¨
```bash
cargo run -p berry-api
```

### è¿è¡ŒCLIå·¥å…·
```bash
# éªŒè¯é…ç½®
cargo run -p berry-cli -- validate-config --config config.toml

# å¥åº·æ£€æŸ¥
cargo run -p berry-cli -- health-check --config config.toml
```

## ğŸ“‹ ä¾èµ–å…³ç³»

```
berry-api     â†’ berry-core, berry-loadbalance, berry-relay
berry-relay   â†’ berry-core, berry-loadbalance  
berry-loadbalance â†’ berry-core
berry-cli     â†’ berry-core, berry-loadbalance
berry-core    â†’ (æ— å†…éƒ¨ä¾èµ–)
```

## âœ… é‡æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–**: æ¯ä¸ªworkspaceä¸“æ³¨äºç‰¹å®šåŠŸèƒ½
2. **å¯å¤ç”¨**: æ ¸å¿ƒåº“å¯ä»¥è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨
3. **ç‹¬ç«‹å¼€å‘**: ä¸åŒå›¢é˜Ÿå¯ä»¥ç‹¬ç«‹å¼€å‘ä¸åŒæ¨¡å—
4. **æµ‹è¯•éš”ç¦»**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•
5. **ç¼–è¯‘ä¼˜åŒ–**: åªç¼–è¯‘éœ€è¦çš„ç»„ä»¶
6. **ä¾èµ–æ¸…æ™°**: æ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œé¿å…å¾ªç¯ä¾èµ–

## ğŸš§ TODO

1. **å®Œå–„å¥åº·æ£€æŸ¥**: é‡æ–°å®ç°çœŸå®çš„AI providerå¥åº·æ£€æŸ¥
2. **å®Œå–„è¯·æ±‚è½¬å‘**: ä¼˜åŒ–OpenAIå®¢æˆ·ç«¯å®ç°
3. **æ·»åŠ æ›´å¤šCLIåŠŸèƒ½**: é…ç½®ç”Ÿæˆã€æ€§èƒ½ç›‘æ§ç­‰
4. **æ–‡æ¡£å®Œå–„**: ä¸ºæ¯ä¸ªworkspaceæ·»åŠ è¯¦ç»†æ–‡æ¡£
5. **æµ‹è¯•è¦†ç›–**: ä¸ºæ¯ä¸ªæ¨¡å—æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

## ğŸ“ æ³¨æ„äº‹é¡¹

- å½“å‰å¥åº·æ£€æŸ¥ä½¿ç”¨ä¸´æ—¶å®ç°ï¼Œéœ€è¦åœ¨é‡æ„å®Œæˆåå®ç°çœŸæ­£çš„å¥åº·æ£€æŸ¥é€»è¾‘
- æŸäº›åŠŸèƒ½å¯èƒ½éœ€è¦åœ¨workspaceä¹‹é—´é‡æ–°è®¾è®¡æ¥å£
- é…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒä¸å˜ï¼Œå‘åå…¼å®¹
