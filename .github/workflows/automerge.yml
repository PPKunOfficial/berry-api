name: Auto Merge PR

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review

permissions:
  contents: write
  pull-requests: write

jobs:
  automerge:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false && github.event.pull_request.state == 'open'
    steps:
      - name: Auto Merge
        uses: pascalgn/automerge-action@v0.16.0
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          # 合并方式：merge, squash, rebase
          # 建议使用 squash，保持提交历史整洁
          MERGE_METHOD: "squash"
          # 如果PR有这些标签，则不会自动合并
          MERGE_LABELS: "automerge,!do-not-merge,!work-in-progress"
          # 自动合并前需要的批准数量
          MERGE_REQUIRED_APPROVALS: "0"
          # 自动合并前需要通过的检查名称列表
          # automerge-action 会自动等待所有在分支保护规则中配置的必需检查通过
          # 所以这里不需要显式列出 required_checks