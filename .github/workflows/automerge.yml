name: Auto Merge PR

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review

permissions:
  contents: write
  pull-requests: write

jobs:
  automerge:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false && github.event.pull_request.state == 'open'
    steps:
      - name: Auto Merge
        uses: pascalgn/automerge-action@v0.16.0
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
        with:
          # 合并方式：merge, squash, rebase
          # 建议使用 squash，保持提交历史整洁
          merge_method: squash
          # 允许的合并方式，确保只使用 squash
          allowed_merge_methods: squash
          # 如果PR有这些标签，则不会自动合并
          do_not_merge_labels: "do-not-merge, work-in-progress"
          # 如果PR有这些标签，则会尝试自动合并
          # pull_request_labels: "automerge" # 如果需要特定标签才自动合并，可以启用此行
          # 自动合并前需要通过的检查名称列表
          # 请将 'Your CI Check Name 1', 'Your CI Check Name 2' 替换为你的实际CI检查名称
          # 例如：'build', 'test', 'lint' 等
          required_checks: "CI Checks" # 请根据你的实际CI检查名称进行修改
          # 自动合并前需要的批准数量
          required_approvals: 0 # 设置为0表示不需要批准，如果需要批准，请设置为大于0的数字
          # 检查是否有合并冲突
          merge_conflicts_label: "has-conflicts" # 如果有冲突，会添加此标签
          # 如果PR是草稿，则不自动合并 (已在 job 的 if 条件中处理)
          # draft: false
